# JIT

#### JIT\(P91\)

Java虚拟机中有许多附加技术用以提升速度。尤其是与加载器操作有关的，被称为“即时”\(Just-In-Time,JIT\)编译器的技术。这种技术可以把程序全部或部分翻译成本地机器码\(这本来是Java虚拟机的工作\)，程序运行速度因此得以提升。

当需要装载某个类\(通常是在为该类创建第一个对象\)时，编译器会先找到其.class文件，然后将该类的字节码装入内存。

此时，有两种方案选择。

1. 让即时编译器编译所有代码。但这种做法有两个缺陷：
   * 加载动作散落在整个程序生命周期内，累加起来要花更多时间；
   * 会增加可执行代码的长度\(字节码要比即时编译器展开后的本地机器码小很多\)，这将导致页面调度，从而降低程序速度。
2. 即时编译器只在必要的时候才编译代码，这种做法被称为惰性评估。这样，从不会被执行的代码也许就压根不会被JIT所编译。

**解释器与JIT编译器**

Java程序最初是仅仅通过解释器解释执行的，即对字节码逐条解释执行，这种方式的执行速度相对会比较慢，尤其当某个方法或代码块运行的特别频繁时，这种方式的执行效率就显得很低。

于是后来在虚拟机中引入了JIT编译器（即时编译器），当虚拟机发现某个方法或代码块运行特别频繁时，就会把这些代码认定为“Hot Spot Code”（热点代码），为了提高热点代码的执行效率，在运行时，虚拟机将会把这些代码编译成与本地平台相关的机器码，并进行各层次的优化，完成这项任务的正是JIT编译器。

二者各有优势：当程序需要迅速启动和执行时，解释器可以首先发挥作用，省去编译的时间，立即执行；当程序运行后，随着时间的推移，编译器逐渐会发挥作用，把越来越多的代码编译成本地代码后，可以获取更高的执行效率。解释执行可以节约内存，而编译执行可以提升效率。

